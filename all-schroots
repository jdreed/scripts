#!/bin/sh

# Usage: all-schroots [-A] PROGRAM ARGUMENTS

# Runs PROGRAM over each of the source (template) build schroots, like
# so:
#
#   PROGRAM SCHROOTNAME ARGUMENTS
#
# If -A is specified, only runs the program over one schroot per
# Debian/Ubuntu version, and ephemeral session chroots are used
# instead of source chroots.

source $(dirname "$0")/debian-versions.sh

if [ "$1" = "-A" ]; then

shift
prog=$1; shift
for code in "$DEBIAN_CODES"; do
    if [ "$code" = "sarge" ]; then
	$prog sarge-i386-sbuild "$@"
    else
	$prog ${code}-amd64-sbuild "$@"
    fi
done

else

prog=$1; shift

for code in "$DEBIAN_CODES"; do
    if [ "$code" = "sarge" ]; then
	$prog sarge-i386-sbuild-source "$@"
    else
	$prog ${code}-i386-sbuild-source "$@"
	$prog ${code}-amd64-sbuild-source "$@"
    fi
done

fi
